---
title: "Using Google Spreadsheets"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(googlesheets)
library(dplyr)
library(ggformula)
library(mosaicCore)
library(mosaic)
knitr::opts_chunk$set(echo = FALSE)
```

```{r read_data, message = FALSE}
con2 <- gs_key("1ucevNh7wKLtOukyEpacUKi5_-KZUQGtIOONhWRnnnQ4")
Globe <- gs_read(con2)
```




## The Globe Toss Activity

In their book [*Teaching Statistics: A bag of tricks*](http://www.stat.columbia.edu/~gelman/bag-of-tricks/), Andrew Gelman and Deborah Nolan describe a nice classroom activity to get students thinking about the confidence interval on a proportion. Here's their description:

> *We ask the class how they miught estimate the proportion of the earth covered by water. After several responses, we bring out an inflatable globe. If we were to take a random sample of points on the globe, then the proportion that touched water would be a reasonable estimate of the overall proportion of water covering the earth. Better yet, we can use a confidence interval to provide an interval estimate of the overall proportion. We explain that the globe will be tossed around the class, and we instruct students to hit the globe with the tip of their index finger when it comes to them. When they do, they are to shout "water!" if their finger touches water, or "land!" if their finger touches land. After the class starts to tire of volleyball, we can use the results to construct a confidence interval for the proportion.*

We're going to modify this activity a little bit:

* Rather than saying "water!" or "land!", we're going to say which body of water is involved (if it's water) or which continent (if it's land).
* We're going to enter the results from each toss in this [this spreadsheet](https://docs.google.com/spreadsheets/d/1ucevNh7wKLtOukyEpacUKi5_-KZUQGtIOONhWRnnnQ4/edit?usp=sharing)
* Rather than simply computing a confidence interval on the sample proportion at the end of the activity, we're going to compute a running proportion that will show after each toss the proportion of water. By plotting out all that out, students will be able to see how the proportion converges. They might be able to extrapolate the pattern to see how many tosses would be needed to achieve a given precision. 

To get started, the instructor should open the spreadsheet and display it to the class. Ask a student to open the spreadsheet as well; he or she will enter the data after each toss. (You'll need to have posted a link to the spreadsheet so that the student can get to it.) If you have a big class, use two or more globes and assign a student to each globe who will enter the data for that globe.


Pictures

... If the finger lands so close to the boundary, ignore that toss. Do over!

At any point, you can display this tutorial to the students. It's here that you can do a statistical analysis, such as calculating the confidence interval on the proportion of tosses that resulted in water.

Within R, you can access the data frame via the name `Globe`. The current version of the spreadsheet will always be used.

```{r see_data, exercise = TRUE, message=FALSE, exercise.setup = "read_data"}
Globe
```




## Cleaning the data

It's often the case that data have some imperfections. For instance, people may have entered invalid levels for the `ocean` variable or the `name` variable.

We want to look for any invalid names. For simplicity, we'll fix them in the spreadsheet itself. (In professional work there are other ways to do things both to avoid errors and to fix them without altering the original data.)

```{r check_ocean, exercise = TRUE, message=FALSE, exercise.setup = "read_data"}
Globe %>%
  group_by(ocean) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
```


```{r check_name, exercise = TRUE, message=FALSE, exercise.setup = "read_data"}
Globe %>%
  group_by(name) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
```

## How much is ocean?

```{r forcalculations, exercise = TRUE, message=FALSE, exercise.setup = "read_data", caption="Your stat calculations"}
Globe <- 
  Globe %>%
  mutate(toss = row_number(), 
         frac_ocean = cumsum(ocean == "yes") / toss)
gf_line(frac_ocean ~ toss, data = Globe) %>%
  gf_point()
```

## How big is Africa versus Asia?

```{r forcalculations2, exercise = TRUE, message=FALSE, exercise.setup = "read_data", caption="More space for calculations"}
Globe <- 
  Globe %>%
  filter(name %in% c("africa", "asia"))
  mutate(toss = row_number(), 
         frac_ocean = cumsum(name = "africa") / toss)
gf_line(frac_ocean ~ toss, data = Globe) %>%
  gf_point()
```

## Setting up a new spreadsheet

You can modify this document to work with a spreadsheet of your own. Here's how.

1. Set up a Google spreadsheet. It's a good idea to populate it with some variable names and a few values. This will let you test to make things are working before you start the activity in class.
2. *Within* the Google spreadsheet document press the "Share" button.

    ```{r echo = FALSE}
knitr::include_graphics("images/google1.png")
```
    
3. After you press "Share," you will see a dialog box. 

    ```{r echo = FALSE}
knitr::include_graphics("images/google2.png")
```
    
    - Pull down the menu to select "Anyone with the link **can edit**." (This is what lets your students add data.) 
    - Copy the link and paste it somewhere you can get to it again. You'll need it. The link will look like this: `https://docs.google.com/spreadsheets/d/1ucevNh7wKLtOukyEpacUKi5_-KZUQGtIOONhWRnnnQ4/edit?usp=sharing`
    - You will also need to copy the *key* that's contained in the link. The key is just the central gibberish in the link, like this: `1ucevNh7wKLtOukyEpacUKi5_-KZUQGtIOONhWRnnnQ4`
        
        
4. Put the link on your course web site so that your students can get to it. That's how they will access the spreadsheet for entering data.

5. Create the R command that will load the spreadsheet data into your R session. 
    ```r
Globe <- gs_read(gs_key("1ucevNh7wKLtOukyEpacUKi5_-KZUQGtIOONhWRnnnQ4"))
```
    In forming the command, replace the quoted string in the above with your own key. The key is located in the center of the link to the spreadsheet: an incomprehensible set of characters similar to that highlighted in **bold** in the example in step (3). You might also replace `Globe` with a name that's more suited to your own activity. 
    
    Paste the command you've created someplace handy. You'll need it. (Suggestion: Paste it next to the link in step (4).)
    
Time for class!    
    
6. Once you reach the point in your class where you want to do statistics on your data, bring up the tutorial document provided for this purpose by StatPREP [located here](). That document has several tutorial command chunks, all of which are blank. You can put any R commands in those chunks, **but make sure** that the command from step (5) always is the first command in any chunk that you use. That way, whenever you run the code in the chunk, the data will be read in from Google. Keep in mind that the chunks are all independent of one another, so you'll need to read in the data in any chunk you use.

Try it out in the following command chunk:

1. Paste in the command you created in step (5).
2. Below that, add any R commands you like.

```{r testme, exercise=TRUE, caption="Try reading your own document.", message = FALSE}

```

    
For instructors who want to write their own tutorial, you will find that this simplifies things since you can arrange to have the spreadsheet data read-in globally and not have to put the data-reading command in every chunk. Use the template `.Rmd` document provided by StatPREP [here](). Modify the chunk named `read_data` the top of the document by inserting your own command (with your own key). Notice that in any new chunk you create, you'll have to reference the `read_data` chunk as the `exercise-setup`. The chunks already in the template document do this, so you can just copy (and rename!) an existing chunk. 



